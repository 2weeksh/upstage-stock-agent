class JudgeAgent:
    def __init__(self, llm):
        # [수정] Judge에게도 Solar Pro 2 Reasoning Mode 적용 및 확인 메시지 출력
        try:
            self.llm = llm.bind(reasoning_effort="high")
            print(f"✅ Judge Agent Reasoning Mode 설정됨: {self.llm.kwargs}")
        except:
            self.llm = llm
            print("⚠️ Judge Agent: 기본 LLM 모드로 실행됩니다.")

    def adjudicate(self, company_name, full_history):
        """
        [Task 3] 최종 투자 전략 수립
        """
        prompt = f"""
        임의로 이모티콘을 사용하지 마시오.

        여러 전문가의 토론 내용을 종합하여 현재 시점에서 가장 합리적인 판단을 내리는 최종 의사결정권자(Judge)입니다.
        아래는 {company_name}에 대한 각 분야 전문가(차트, 뉴스, 재무)들의 치열한 토론 기록입니다.

        이 내용을 바탕으로 모호하지 않은 '실전 투자 전략 보고서'를 작성하십시오.
        토론 기록에는 같은 내용이 반복되어 있습니다. 이를 그대로 베끼지 말고, 내용 중복을 금지합니다.

        [전체 토론 기록]
        {full_history}

        1. 중복 금지: 토론에 나온 내용을 그대로 복사하지 말고, 당신의 언어로 통찰(Insight)을 재구성하십시오.
        2. 명확성: 모호한 표현 대신 "매수", "관망" 등 확실한 태도를 취하십시오.
        3. 형식 준수: 아래 [보고서 양식]을 틀리지 말고 구조를 지키십시오.

        [보고서 양식]

        1. 최종 판결
        
        [등급] (점수) - 핵심 근거 한 줄 요약
        (출력 예시: [매수] (7.5점) - 실적 개선세가 뚜렷하나 단기 차익 실현 매물 소화 필요)

        2. 등급 기준표
        (아래 표를 내용을 절대 바꾸지 말고 그대로 출력하십시오. 당신이 최종 판결에서 받은 점수가 속하는 단 하나의 행 전체(반드시 하나의 행)만 굵게 하여 강조하시오.)

        | 점수 범위 | 등급 | 의미 |
        |---|---|---|
        | 8.0 ~ 10.0 | [강력 매수] | 압도적 호재와 상승 모멘텀 | 
        | 6.0 ~ 7.9 | [매수] | 우상향 기대 및 긍정적 지표 | 
        | 4.0 ~ 5.9 | [중립] | 방향성 불분명, 관망 필요 | 
        | 2.0 ~ 3.9 | [매도] | 하방 압력 존재, 리스크 관리 | 
        | 0.0 ~ 1.9 | [강력 매도] | 심각한 악재, 하락 추세 뚜렷 | 

        3. 핵심 승리 논리 3가지 (토론 과정에서 가장 설득력 있었던 근거)
            - [승리 논리 1]
            - [승리 논리 2]
            - [승리 논리 3]

        4. 주요 리스크 (토론에서 지적된 치명적 약점)
            - [주요 리스크 1]
            - [주요 리스크 2]
            - [주요 리스크 3]

        5. 구체적 트레이딩 시나리오
           - 적정 진입 가격대 (구체적 숫자 제시)
           - 1차 목표가 / 2차 목표가
           - 손절가 (Stop Loss)

        더이상 작성하지 마시오.

        결과는 가독성 좋은 Markdown 형식으로 출력하세요.
        """
        return self.llm.invoke(prompt).content